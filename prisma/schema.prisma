generator client {
provider = "prisma-client-js"
}


datasource db {
provider = "postgresql"
url = env("DATABASE_URL")
}


model User {
id String @id @default(uuid())
name String
email String @unique
passwordHash String
role String @default("client") // owner | staff | client
restaurant Restaurant? @relation(fields: [restaurantId], references: [id])
restaurantId String?
orders Order[]
createdAt DateTime @default(now())
updatedAt DateTime @updatedAt
}


model Restaurant {
id String @id @default(uuid())
name String
address String?
email String?
phone String?
logoUrl String?
users User[]
tables Table[]
menuItems MenuItem[]
orders Order[]
createdAt DateTime @default(now())
updatedAt DateTime @updatedAt
}


model Table {
id String @id @default(uuid())
restaurant Restaurant @relation(fields: [restaurantId], references: [id])
restaurantId String
tableNumber Int
qrCodeUrl String?
status String @default("active") // active, closed, etc.
orders Order[]
createdAt DateTime @default(now())
updatedAt DateTime @updatedAt
}


model Order {
id String @id @default(uuid())
restaurant Restaurant @relation(fields: [restaurantId], references: [id])
restaurantId String
table Table @relation(fields: [tableId], references: [id])
tableId String
user User? @relation(fields: [userId], references: [id])
userId String?
status String @default("pending") // pending, preparing, served, paid
totalAmount Float @default(0)
items OrderItem[]
payment Payment?
createdAt DateTime @default(now())
updatedAt DateTime @updatedAt
}


model OrderItem {
id String @id @default(uuid())
order Order @relation(fields: [orderId], references: [id])
orderId String
menuItem MenuItem @relation(fields: [menuItemId], references: [id])
menuItemId String
quantity Int @default(1)
price Float
notes String?
}


model MenuItem {
id String @id @default(uuid())
restaurant Restaurant @relation(fields: [restaurantId], references: [id])
restaurantId String
name String
description String?
price Float
imageUrl String?
allergens String?
available Boolean @default(true)
orderItems OrderItem[]
createdAt DateTime @default(now())
updatedAt DateTime @updatedAt
}


model Payment {
id String @id @default(uuid())
order Order @relation(fields: [orderId], references: [id])
orderId String @unique
amount Float
method String // card, cash, bizum
status String @default("pending") // pending, completed, failed
paymentRef String?
createdAt DateTime @default(now())
}